# Toolforge Buildservice Log Wrangler

## Overview

Ad-hoc utility for wrangling and analyzing logs generated by the Toolforge buildservice.
It turns a logfile (txt) into a csv with the following format:

```csv
id,step,timestamp,entry,delta
8,step-copy-builder-to-tmp,2024-01-18T08:58:36.588102,"unsuccessful cred copy: "".docker"" from ""/tekton/creds"" to ""/tekton/home"": unable to open destination: open /tekton/home/.docker/config.json: permission denied",13.5667
9,step-copy-stack-toml,2024-01-18T08:58:49.883078,"unsuccessful cred copy: "".docker"" from ""/tekton/creds"" to ""/tekton/home"": unable to open destination: open /tekton/home/.docker/config.json: permission denied",13.2950
10,step-analyze,2024-01-18T08:59:15.568670,"unsuccessful cred copy: "".docker"" from ""/tekton/creds"" to ""/tekton/home"": unable to open destination: open /tekton/home/.docker/config.json: permission denied",25.6856
...
```

## Usage

1. **Prepare Your Log File**: Ensure your log file from the Toolforge buildservice is in a plain text format.

2. **Run the Script**: Use the script to process the log file. The script reads the log entries, sorts them, and calculates the time delta between entries.

   ```bash
   python parselog.py -f <input_log_file> -o <output_csv_file>
   ```

Once you have the CSV, you can use the `csvkit` for more
advanced wrangling and querying directly from the terminal:

```bash
csvsql --query "SELECT * FROM <csv_file_name> WHERE delta >= 2.0000 ORDER BY delta DESC" <csv_file_name> > <output_file>
```

Example output:

```csv
id,step,entry,delta
799,step-build,wheel for uwsgi (setup.py): finished with status 'done',8.2145
770,step-build,,3.4227
761,step-analyze,SBOM from previous image,3.2822
769,step-build,setuptools 68.0.0 and wheel 0.42.0,2.4515
762,step-build,,2.3987
```
